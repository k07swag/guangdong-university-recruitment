<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¹¿ä¸œçœé«˜æ ¡æ•™å¸ˆå²—Â·è¡Œæ”¿å²—æ‹›è˜ä¿¡æ¯</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f1419;
      --card: #1a2332;
      --border: #2d3a4d;
      --text: #e6edf3;
      --muted: #8b949e;
      --accent: #58a6ff;
      --accent-visited: #a371f7;
      --teacher: #3fb950;
      --admin: #d29922;
    }
    * { box-sizing: border-box; }
    body {
      font-family: "Noto Sans SC", -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px 16px 48px;
      min-height: 100vh;
    }
    .container { max-width: 960px; margin: 0 auto; }
    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin: 0 0 8px;
      letter-spacing: -0.02em;
    }
    .subtitle {
      color: var(--muted);
      font-size: 0.95rem;
      margin-bottom: 24px;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 24px;
      padding: 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .filters label { margin-right: 6px; color: var(--muted); font-size: 0.9rem; }
    .filters select {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .meta {
      color: var(--muted);
      font-size: 0.85rem;
      margin-bottom: 20px;
    }
    .meta a { color: var(--accent); }
    section {
      margin-bottom: 32px;
    }
    section h2 {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0 0 12px;
      color: var(--text);
    }
    .job-list, .school-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .job-item { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 14px 16px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
    .school-item-wrapper { position: relative; margin-bottom: 10px; }
    .school-item {
      border-radius: 10px;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      border: 1px solid var(--border);
      transition: background 0.2s;
    }
    .school-item.cat-985 { background: rgba(88, 166, 255, 0.22); }
    .school-item.cat-211 { background: rgba(88, 166, 255, 0.16); }
    .school-item.cat-æ™®é€šä¸€æœ¬ { background: rgba(88, 166, 255, 0.11); }
    .school-item.cat-æ™®é€šäºŒæœ¬ { background: rgba(88, 166, 255, 0.07); }
    .school-item.cat-æ™®é€šä¸‰æœ¬ { background: rgba(88, 166, 255, 0.04); }
    .school-item.cat-å¤§ä¸“ { background: rgba(88, 166, 255, 0.02); }
    .school-item:not([class*="cat-"]) { background: var(--card); }
    .job-item a, .school-item a {
      color: var(--accent);
      text-decoration: none;
    }
    .job-item a:hover, .school-item a:hover { text-decoration: underline; }
    .job-item a:visited, .school-item a:visited { color: var(--accent-visited); }
    .job-type {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 6px;
      flex-shrink: 0;
    }
    .job-type.æ•™å¸ˆå²— { background: rgba(63, 185, 80, 0.2); color: var(--teacher); }
    .job-type.è¡Œæ”¿å²— { background: rgba(210, 153, 34, 0.2); color: var(--admin); }
    .job-type.å…¶ä»– { background: rgba(88, 166, 255, 0.2); color: var(--accent); }
    .job-school, .school-name { color: var(--muted); font-size: 0.9rem; }
    .school-item .link-wrap { margin-left: auto; text-align: right; display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
    .link-primary { font-weight: 500; }
    .search-fallback { font-size: 1rem; text-decoration: none; }
    .search-fallback:hover { text-decoration: underline; }
    .new-badge { font-size: 0.65rem; color: var(--teacher); margin-right: 4px; font-weight: 600; }
    .wen-badge { font-size: 0.75rem; color: var(--muted); margin-right: 6px; }
    .school-item-dropdown {
      background: rgba(88, 166, 255, 0.15); border: 1px solid var(--border); border-top: none;
      border-radius: 0 0 10px 10px; max-height: 0; overflow: hidden;
      padding: 0 16px; transition: max-height 0.5s ease;
    }
    .school-item-wrapper:hover .school-item-dropdown { max-height: 180px; padding: 10px 16px; overflow: auto; }
    .school-item-dropdown a { display: block; color: var(--accent); font-size: 0.85rem; padding: 4px 0; text-decoration: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .school-item-dropdown a:hover { text-decoration: underline; }
    .school-item-dropdown .muted { color: var(--muted); font-size: 0.85rem; }
    .empty { color: var(--muted); padding: 24px; text-align: center; }
    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
    }
    .tabs button {
      padding: 10px 20px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .tabs button:hover { border-color: var(--accent); }
    .tabs button.active { background: var(--accent); border-color: var(--accent); color: var(--bg); }
    .panel { display: none; }
    .panel.active { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <h1>å¹¿ä¸œçœé«˜æ ¡æ•™å¸ˆå²— Â· è¡Œæ”¿å²—æ‹›è˜ä¿¡æ¯</h1>
    <p class="subtitle">æ”¶é›†å¹¿ä¸œçœå†…æœ¬ç§‘ã€ä¸“ç§‘é™¢æ ¡äººäº‹å¤„/æ‹›è˜é¡µå…¥å£ä¸æŠ“å–çš„æ‹›è˜å…¬å‘Šï¼Œä¾¿äºç»Ÿä¸€æŸ¥çœ‹ä¸æ›´æ–°ã€‚</p>

    <div class="filters">
      <span><label>åŸå¸‚</label>
        <select id="filterCity">
          <option value="">å…¨éƒ¨åŸå¸‚</option>
        </select>
      </span>
      <span><label>é™¢æ ¡ç±»å‹</label>
        <select id="filterSchoolType">
          <option value="">å…¨éƒ¨</option>
          <option value="æœ¬ç§‘">æœ¬ç§‘</option>
          <option value="ä¸“ç§‘">ä¸“ç§‘</option>
        </select>
      </span>
      <span><label>é™¢æ ¡å±‚æ¬¡</label>
        <select id="filterCategory">
          <option value="">å…¨éƒ¨</option>
          <option value="985">985</option>
          <option value="211">211</option>
          <option value="æ™®é€šä¸€æœ¬">æ™®é€šä¸€æœ¬</option>
          <option value="æ™®é€šäºŒæœ¬">æ™®é€šäºŒæœ¬</option>
          <option value="æ™®é€šä¸‰æœ¬">æ™®é€šä¸‰æœ¬</option>
          <option value="å¤§ä¸“">å¤§ä¸“</option>
        </select>
      </span>
    </div>

    <p class="meta" id="meta">åŠ è½½ä¸­â€¦</p>

    <div class="tabs">
      <button type="button" data-tab="schools">æŒ‰å­¦æ ¡å…¥å£ï¼ˆ106 æ‰€é™¢æ ¡ç›´è¾¾é“¾æ¥ï¼‰</button>
      <button type="button" data-tab="jobs">æ‹›è˜ä¿¡æ¯åˆ—è¡¨</button>
    </div>

    <section id="panel-schools" class="panel active">
      <h2>å„æ ¡æ‹›è˜/äººäº‹å¤„å…¥å£</h2>
      <p class="meta" style="margin-top:0;">ã€Œ<strong>æ‹›è˜é¡µ</strong>ã€ä¸ºç™¾åº¦æœç´¢ã€Œæ ¡å äººäº‹ æ‹›è˜ã€ç»“æœä¸­çš„ã€å®˜æ–¹ã€‘æˆ–ç¬¬ä¸€æ¡äººäº‹/æ‹›è˜é“¾æ¥ï¼›æ— åˆ™æ‰“å¼€è¯¥æœç´¢é¡µã€‚ã€Œ<strong>ğŸ”</strong>ã€å§‹ç»ˆæ‰“å¼€ç™¾åº¦æœç´¢é¡µï¼Œå¯è‡ªè¡Œç‚¹å‡»ã€å®˜æ–¹ã€‘é“¾æ¥ã€‚</p>
      <ul class="school-list" id="schoolList"></ul>
    </section>

    <section id="panel-jobs" class="panel">
      <h2>æ‹›è˜ä¿¡æ¯ï¼ˆæ¥è‡ªå„æ ¡äººäº‹å¤„é¡µé¢æŠ“å–ï¼‰</h2>
      <ul class="job-list" id="jobList"></ul>
      <p class="empty" id="jobEmpty" style="display:none;">æš‚æ— æŠ“å–åˆ°çš„æ‹›è˜æ¡ç›®ã€‚åœ¨ç»ˆç«¯æ‰§è¡Œï¼š<br><code>cd é¡¹ç›®ç›®å½• && pip3 install -r requirements.txt && python3 update_jobs.py</code></p>
    </section>
  </div>

  <script>
    let jobsData = { last_updated: "", jobs: [], sources: [] };
    let universitiesData = { universities: [] };
    let currentCity = "";
    let currentSchoolType = "";
    let currentCategory = "";

    const CATEGORY_ORDER = { "985": 0, "211": 1, "æ™®é€šä¸€æœ¬": 2, "æ™®é€šäºŒæœ¬": 3, "æ™®é€šä¸‰æœ¬": 4, "å¤§ä¸“": 5 };
    const WEN_KEYWORDS = /æ–‡|æ–‡å­¦|å†å²|å“²å­¦|æ³•å­¦|æ”¿æ²»|ç¤¾ä¼š|ä¼ åª’|è¯­è¨€|è‰ºæœ¯|æ•™è‚²|å¿ƒç†|é©¬é™¢|æ€æ”¿|ä¸­æ–‡|å¤–è¯­|ç»ç®¡|æ–°é—»|ä¼ æ’­|äººæ–‡/i;

    function isWithin7Days(dateStr) {
      if (!dateStr) return false;
      const d = new Date(dateStr); if (isNaN(d.getTime())) return false;
      const now = new Date(); const diff = (now - d) / (24 * 60 * 60 * 1000);
      return diff >= 0 && diff <= 7;
    }

    function getSchoolJobs(schoolName) {
      const jobs = (jobsData.jobs || []).filter(j => j.school === schoolName);
      jobs.sort((a, b) => (b.fetched_at || "").localeCompare(a.fetched_at || ""));
      return jobs;
    }

    function isArticleLikeTitle(title) {
      const t = (title || "").trim();
      const navLike = /^(äººäº‹æ”¿ç­–|äººäº‹æ”¹é©|å·¥ä½œæµç¨‹|åŠäº‹æŒ‡å—|æœºæ„è®¾ç½®|è§„ç« åˆ¶åº¦|ä¸‹è½½ä¸“åŒº|é€šçŸ¥å…¬å‘Š|æ‹›è˜ä¿¡æ¯|é¦–é¡µ|æ›´å¤š|åˆ—è¡¨|æ ç›®|æ”¿ç­–æ³•è§„|å¸ˆèµ„é˜Ÿä¼|éƒ¨é—¨ä»‹ç»|è”ç³»æˆ‘ä»¬|äººæ‰æ‹›è˜)$/;
      if (navLike.test(t) || t.length <= 4) return false;
      if (/å…¬å‘Š|é€šçŸ¥|åŠæ³•|æ¡ä¾‹|å¯äº‹|å…¬ç¤º|ç®€ç« |è®¡åˆ’|è§„å®š|æ„è§/.test(t)) return true;
      if (/20\d{2}/.test(t)) return true;
      return t.length >= 12;
    }

    function isRecruitmentOrTalentRelated(title) {
      const t = (title || "").trim();
      if (!t) return false;
      const recruitmentKeywords = /æ‹›è˜|äººæ‰å¼•è¿›|äººæ‰æ”¿ç­–|å¼•è¿›|æ‹›å½•|é€‰è˜|è˜ä»»|äººæ‰éœ€æ±‚|é«˜å±‚æ¬¡äººæ‰|æ‹›è˜å…¬å‘Š|æ‹›è˜å¯äº‹|æ•™å¸ˆæ‹›è˜|è¡Œæ”¿æ‹›è˜|ä¸“èŒæ•™å¸ˆ|äººäº‹(æ‹›è˜|å¼•è¿›)/;
      return recruitmentKeywords.test(t);
    }

    function getTop3ArticleLikeJobs(schoolJobs) {
      const articleLike = schoolJobs.filter(j => isArticleLikeTitle(j.title));
      const recruitmentRelated = articleLike.filter(j => isRecruitmentOrTalentRelated(j.title));
      const pool = recruitmentRelated.length > 0 ? recruitmentRelated : articleLike;
      return pool.slice(0, 3);
    }

    async function loadData() {
      try {
        const [jobsRes, univRes] = await Promise.all([
          fetch("data/jobs.json"),
          fetch("data/universities_guangdong.json")
        ]);
        if (jobsRes.ok) jobsData = await jobsRes.json();
        if (univRes.ok) universitiesData = await univRes.json();
      } catch (e) {
        console.error(e);
        document.getElementById("meta").textContent = "æ— æ³•åŠ è½½ data ä¸‹çš„ JSONï¼ˆè¯·ç”¨æœ¬åœ°æœåŠ¡å™¨æ‰“å¼€é¡µé¢ï¼Œå¦‚ python -m http.serverï¼‰ã€‚";
        return;
      }
      const u = universitiesData.universities || [];
      const jobs = jobsData.jobs || [];
      document.getElementById("meta").innerHTML =
        "æ•°æ®æ›´æ–°æ—¶é—´ï¼š<strong>" + (jobsData.last_updated || "â€”") + "</strong>ã€‚"
        + " å…± " + u.length + " æ‰€é™¢æ ¡ã€å½“å‰æŠ“å– " + jobs.length + " æ¡æ‹›è˜ç›¸å…³ä¿¡æ¯ã€‚"
        + " æ›´æ–°æ–¹å¼è§ READMEã€‚";
      fillCityOptions(u);
      renderJobs();
      renderSchools(u);
    }

    function fillCityOptions(universities) {
      const set = new Set(universities.map(x => x.city).filter(Boolean));
      const sel = document.getElementById("filterCity");
      ["å…¨éƒ¨åŸå¸‚", ...Array.from(set).sort()].forEach((c, i) => {
        const opt = document.createElement("option");
        opt.value = i === 0 ? "" : c;
        opt.textContent = c;
        sel.appendChild(opt);
      });
      sel.addEventListener("change", () => { currentCity = sel.value; renderJobs(); renderSchools(universitiesData.universities || []); });
    }

    document.getElementById("filterSchoolType").addEventListener("change", function() {
      currentSchoolType = this.value;
      renderJobs();
      renderSchools(universitiesData.universities || []);
    });
    document.getElementById("filterCategory").addEventListener("change", function() {
      currentCategory = this.value;
      renderSchools(universitiesData.universities || []);
    });

    function filterJob(job) {
      const schools = universitiesData.universities || [];
      const school = schools.find(s => s.name === job.school);
      if (currentCity && (!school || school.city !== currentCity)) return false;
      if (currentSchoolType && (!school || school.type !== currentSchoolType)) return false;
      return true;
    }

    function renderJobs() {
      const jobs = (jobsData.jobs || []).filter(filterJob);
      const ul = document.getElementById("jobList");
      const empty = document.getElementById("jobEmpty");
      ul.innerHTML = "";
      if (jobs.length === 0) {
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";
      jobs.forEach(job => {
        const li = document.createElement("li");
        li.className = "job-item";
        li.innerHTML =
          "<span class=\"job-school\">" + escapeHtml(job.school) + "</span> "
          + "<span class=\"job-type " + escapeHtml(job.type) + "\">" + escapeHtml(job.type) + "</span> "
          + "<a href=\"" + escapeHtml(job.url) + "\" target=\"_blank\" rel=\"noopener\">" + escapeHtml(job.title) + "</a>";
        ul.appendChild(li);
      });
    }

    function renderSchools(universities) {
      let list = universities;
      if (currentCity) list = list.filter(u => u.city === currentCity);
      if (currentSchoolType) list = list.filter(u => u.type === currentSchoolType);
      if (currentCategory) list = list.filter(u => (u.category || "") === currentCategory);
      list = list.slice().sort((a, b) => {
        const cityC = (a.city || "").localeCompare(b.city || "");
        if (cityC !== 0) return cityC;
        const typeOrder = (x) => (x.type === "æœ¬ç§‘" ? 0 : 1);
        const typeC = typeOrder(a) - typeOrder(b);
        if (typeC !== 0) return typeC;
        return (CATEGORY_ORDER[a.category] ?? 99) - (CATEGORY_ORDER[b.category] ?? 99);
      });
      const ul = document.getElementById("schoolList");
      ul.innerHTML = "";
      list.forEach(u => {
        const officialPageUrl = (u.recruitment_url || "").trim();
        const baiduSearchUrl = "https://www.baidu.com/s?wd=" + encodeURIComponent(u.name + " äººäº‹éƒ¨ æ‹›è˜");
        const category = u.category || "";
        const primaryHref = officialPageUrl || baiduSearchUrl;
        const schoolJobs = getSchoolJobs(u.name);
        const recentJobs = schoolJobs.filter(j => isWithin7Days(j.fetched_at));
        const hasNew = recentJobs.length > 0;
        const hasWen = recentJobs.some(j => WEN_KEYWORDS.test(j.title || ""));
        const top3 = getTop3ArticleLikeJobs(schoolJobs);
        const catClass = category ? " cat-" + category.replace(/\s/g, "") : "";
        const wrapper = document.createElement("li");
        wrapper.className = "school-item-wrapper";
        const newHtml = hasNew ? "<span class=\"new-badge\">new</span>" : "";
        const wenHtml = hasWen ? "<span class=\"wen-badge\">æ–‡</span>" : "";
        const dropdownHtml = top3.length > 0
          ? "<div class=\"school-item-dropdown\">" + top3.map(j => "<a href=\"" + escapeHtml(j.url) + "\" target=\"_blank\" rel=\"noopener\" title=\"" + escapeHtml(j.title) + "\">" + escapeHtml(j.title) + "</a>").join("") + "</div>"
          : "<div class=\"school-item-dropdown\"><span class=\"muted\">æš‚æ— æŠ“å–å…¬å‘Šï¼Œè¿è¡Œ update_jobs.py å¯æ›´æ–°</span></div>";
        wrapper.innerHTML =
          "<div class=\"school-item" + catClass + "\">"
          + "<span class=\"school-name\">" + escapeHtml(u.name) + " Â· " + escapeHtml(u.city || "") + " Â· " + escapeHtml(u.type || "") + (category ? " Â· " + escapeHtml(category) : "") + "</span> "
          + "<span class=\"link-wrap\">" + newHtml + wenHtml + "<a href=\"" + escapeHtml(primaryHref) + "\" target=\"_blank\" rel=\"noopener\" class=\"link-primary\">æ‹›è˜é¡µ</a>"
          + " <a href=\"" + escapeHtml(baiduSearchUrl) + "\" target=\"_blank\" rel=\"noopener\" class=\"search-fallback\" title=\"ç™¾åº¦æœç´¢è¯¥æ ¡äººäº‹éƒ¨æ‹›è˜\">ğŸ”</a></span></div>"
          + dropdownHtml;
        ul.appendChild(wrapper);
      });
    }

    function escapeHtml(s) {
      if (s == null) return "";
      const div = document.createElement("div");
      div.textContent = s;
      return div.innerHTML;
    }

    document.querySelectorAll(".tabs button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById("panel-" + btn.dataset.tab).classList.add("active");
      });
    });
    // é»˜è®¤é€‰ä¸­ã€ŒæŒ‰å­¦æ ¡å…¥å£ã€
    document.querySelector(".tabs button[data-tab='schools']").classList.add("active");
    document.querySelector("#panel-jobs").classList.remove("active");
    document.querySelector("#panel-schools").classList.add("active");

    loadData();
  </script>
</body>
</html>
