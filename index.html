<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¹¿ä¸œçœé«˜æ ¡æ•™å¸ˆå²—Â·è¡Œæ”¿å²—æ‹›è˜ä¿¡æ¯</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f1419;
      --card: #1a2332;
      --border: #2d3a4d;
      --text: #e6edf3;
      --muted: #8b949e;
      --accent: #58a6ff;
      --accent-visited: #a371f7;
      --teacher: #3fb950;
      --admin: #d29922;
    }
    * { box-sizing: border-box; }
    body {
      font-family: "Noto Sans SC", -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px 16px 48px;
      min-height: 100vh;
    }
    .container { max-width: 960px; margin: 0 auto; }
    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin: 0 0 8px;
      letter-spacing: -0.02em;
    }
    .subtitle {
      color: var(--muted);
      font-size: 0.95rem;
      margin-bottom: 24px;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 24px;
      padding: 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .filters label { margin-right: 6px; color: var(--muted); font-size: 0.9rem; }
    .filters select {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .meta {
      color: var(--muted);
      font-size: 0.85rem;
      margin-bottom: 20px;
    }
    .meta a { color: var(--accent); }
    section {
      margin-bottom: 32px;
    }
    section h2 {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0 0 12px;
      color: var(--text);
    }
    .job-list, .school-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .job-item { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 14px 16px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
    .school-item-wrapper { position: relative; margin-bottom: 10px; }
    .school-item {
      border-radius: 10px;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      border: 1px solid var(--border);
      transition: background 0.2s;
    }
    .school-item { background: var(--card); }
    .job-item a, .school-item a {
      color: var(--accent);
      text-decoration: none;
    }
    .job-item a:hover, .school-item a:hover { text-decoration: underline; }
    .job-item a:visited, .school-item a:visited { color: var(--accent-visited); }
    .job-type {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 6px;
      flex-shrink: 0;
    }
    .job-type.æ•™å¸ˆå²— { background: rgba(63, 185, 80, 0.2); color: var(--teacher); }
    .job-type.è¡Œæ”¿å²— { background: rgba(210, 153, 34, 0.2); color: var(--admin); }
    .job-type.å…¶ä»– { background: rgba(88, 166, 255, 0.2); color: var(--accent); }
    .job-school, .school-name { color: var(--muted); font-size: 0.9rem; }
    .school-item .link-wrap { margin-left: auto; text-align: right; display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
    .link-primary { font-weight: 500; }
    .search-fallback { font-size: 1rem; text-decoration: none; }
    .search-fallback:hover { text-decoration: underline; }
    .new-badge { font-size: 0.65rem; color: var(--teacher); margin-right: 4px; font-weight: 600; padding: 1px 4px; border-radius: 4px; background: rgba(63,185,80,0.15); }
    .wen-badge { font-size: 0.75rem; color: var(--muted); margin-right: 6px; padding: 1px 4px; border-radius: 4px; background: rgba(139,148,158,0.15); }
    .yi-badge { font-size: 0.75rem; color: #d29922; margin-right: 6px; font-weight: 600; padding: 1px 4px; border-radius: 4px; background: rgba(210,153,34,0.15); }
    .school-item-dropdown {
      background: rgba(88, 166, 255, 0.15); border: 1px solid var(--border); border-top: none;
      border-radius: 0 0 10px 10px; max-height: 0; overflow: hidden;
      padding: 0 16px; transition: max-height 0.5s ease;
    }
    .school-item-wrapper:hover .school-item-dropdown { max-height: 180px; padding: 10px 16px; overflow: auto; }
    .school-item-dropdown a { display: block; color: var(--accent); font-size: 0.85rem; padding: 4px 0; text-decoration: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .school-item-dropdown a:hover { text-decoration: underline; }
    .school-item-dropdown .muted { color: var(--muted); font-size: 0.85rem; }
    .empty { color: var(--muted); padding: 24px; text-align: center; }
    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
    }
    .tabs button {
      padding: 10px 20px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .tabs button:hover { border-color: var(--accent); }
    .tabs button.active { background: var(--accent); border-color: var(--accent); color: var(--bg); }
    .panel { display: none; }
    .panel.active { display: block; }
    .footer-legend { margin-top: 32px; padding-top: 20px; border-top: 1px solid var(--border); color: var(--muted); font-size: 0.8rem; line-height: 1.9; }
    .footer-legend strong { color: var(--text); }
    .footer-cheer { margin-top: 16px; font-size: 0.95rem; color: var(--accent); text-align: center; }
    .notebook-btn {
      position: fixed; right: 20px; top: 50%; transform: translateY(-50%);
      z-index: 100; padding: 12px 16px; border-radius: 10px;
      background: var(--card); border: 1px solid var(--border); color: var(--text);
      cursor: pointer; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.3);
    }
    .notebook-btn:hover { border-color: var(--accent); }
    .notebook-panel {
      display: none; position: fixed; z-index: 1000;
      min-width: 280px; min-height: 200px; max-width: 90vw; max-height: 80vh;
      background: var(--card); border: 1px solid var(--border); border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4); flex-direction: column;
    }
    .notebook-panel.open { display: flex; }
    .notebook-head {
      padding: 10px 12px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      cursor: move; user-select: none; background: rgba(0,0,0,0.2);
      border-radius: 12px 12px 0 0;
    }
    .notebook-head span { font-weight: 600; font-size: 0.9rem; }
    .notebook-toolbar {
      display: flex; flex-wrap: wrap; gap: 6px; padding: 8px 10px;
      border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.1);
    }
    .notebook-toolbar button, .notebook-toolbar input[type="color"] {
      padding: 4px 8px; border: 1px solid var(--border); border-radius: 6px;
      background: var(--bg); color: var(--text); cursor: pointer; font-size: 0.8rem;
    }
    .notebook-toolbar input[type="color"] { width: 28px; height: 24px; padding: 2px; cursor: pointer; }
    .notebook-toolbar input[type="range"] { width: 70px; vertical-align: middle; }
    .notebook-body {
      flex: 1; padding: 12px; overflow: auto;
      outline: none; font-size: 0.9rem; line-height: 1.6;
      min-height: 120px;
      word-wrap: break-word; overflow-wrap: break-word;
    }
    .notebook-body:empty::before { content: "åœ¨æ­¤è®°å½•â€¦"; color: var(--muted); }
    .notebook-body [contenteditable="true"] { min-height: 1em; word-wrap: break-word; overflow-wrap: break-word; }
    .notebook-checklist-item { display: flex; align-items: flex-start; gap: 8px; margin: 6px 0; }
    .notebook-checklist-item input[type="checkbox"] { flex-shrink: 0; cursor: pointer; margin-top: 4px; }
    .notebook-checklist-item .nb-check-text { flex: 1; min-width: 0; word-wrap: break-word; overflow-wrap: break-word; outline: none; white-space: pre-wrap; }
    .notebook-checklist-item.done .nb-check-text { opacity: 0.7; text-decoration: line-through; }
    .notebook-panel .resize-handle { position: absolute; right: 0; bottom: 0; width: 20px; height: 20px; cursor: nwse-resize; }
    .notebook-mini {
      display: none; position: fixed; z-index: 999;
      background: var(--card); border: 1px solid var(--border); border-radius: 10px;
      padding: 8px 12px; align-items: center; gap: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3); cursor: move; user-select: none;
    }
    .notebook-mini.visible { display: flex; }
    .notebook-mini.minimized { padding: 6px 10px; right: 0; top: 12px; left: auto; transform: translateX(calc(100% - 2.5em)); }
    .notebook-mini.minimized .nb-mini-close { display: none; }
    .notebook-mini.fly-to-corner { transition: left 0.45s cubic-bezier(0.25, 0.1, 0.25, 1), top 0.45s cubic-bezier(0.25, 0.1, 0.25, 1), right 0.45s cubic-bezier(0.25, 0.1, 0.25, 1); }
    .notebook-mini .nb-mini-icon { font-size: 1.2rem; cursor: pointer; }
    .notebook-mini .nb-mini-close { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1.1rem; padding: 0 2px; }
    .cheer-emoji { position: fixed; pointer-events: none; z-index: 2000; font-size: 1.5rem; animation: cheerFly 1.2s ease-out forwards; }
    @keyframes cheerFly {
      0% { opacity: 1; transform: translate(0,0) scale(1); }
      100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0.5); }
    }
  </style>
</head>
<body>
  <button type="button" class="notebook-btn" id="notebookBtn" title="æ‰“å¼€è®°äº‹æœ¬">ğŸ“ è®°äº‹æœ¬</button>
  <div class="notebook-mini" id="notebookMini">
    <span class="nb-mini-icon" id="nbMiniIcon">ğŸ“</span>
    <button type="button" class="nb-mini-close" id="nbMiniClose">Ã—</button>
  </div>
  <div class="notebook-panel" id="notebookPanel">
    <div class="notebook-head" id="notebookHead">
      <span>ğŸ“ è®°äº‹æœ¬</span>
      <button type="button" id="notebookClose" style="background:transparent;border:none;color:var(--muted);cursor:pointer;font-size:1.2rem;">Ã—</button>
    </div>
    <div class="notebook-toolbar">
      <button type="button" id="nbBold" title="åŠ ç²—">B</button>
      <input type="color" id="nbColor" value="#e6edf3" title="å­—ä½“é¢œè‰²" />
      <button type="button" id="nbChecklist" title="æ’å…¥å¾…åŠ">â˜‘ å¾…åŠ</button>
      <label style="display:inline-flex;align-items:center;gap:4px;"><span>é€æ˜åº¦</span><input type="range" id="nbOpacity" min="0.5" max="1" step="0.05" value="0.98" /></label>
      <label style="display:inline-flex;align-items:center;gap:4px;" title="åˆ‡æ¢æ—¥æœŸå¯æŸ¥çœ‹/ç¼–è¾‘è¯¥æ—¥çš„è‰ç¨¿"><span>æ—¥æœŸ</span><select id="nbDateSelect" style="padding:4px 8px;border-radius:6px;background:var(--bg);color:var(--text);border:1px solid var(--border);font-size:0.8rem;"></select></label>
      <span class="muted" style="font-size:0.75rem;">ï¼ˆæŒ‰æ—¥æœŸä¿å­˜ï¼Œåˆ‡æ¢å¯æŸ¥å¾€æ—¥è‰ç¨¿ï¼›å½“æ—¥å¤šæ¬¡ä¿å­˜ä¼šè¦†ç›–ä¸ºæœ€æ–°ï¼‰</span>
      <button type="button" id="nbSave" style="padding:4px 10px;border-radius:6px;background:var(--accent);color:var(--bg);border:none;cursor:pointer;font-size:0.8rem;">ä¿å­˜</button>
    </div>
    <div class="notebook-body" id="notebookBody" contenteditable="true"></div>
    <div class="resize-handle" id="notebookResize"></div>
  </div>
  <div class="container">
    <h1>å¹¿ä¸œçœé«˜æ ¡æ•™å¸ˆå²— Â· è¡Œæ”¿å²—æ‹›è˜ä¿¡æ¯</h1>
    <p class="subtitle">æ”¶é›†å¹¿ä¸œçœå†…æœ¬ç§‘ã€ä¸“ç§‘é™¢æ ¡äººäº‹å¤„/æ‹›è˜é¡µå…¥å£ä¸æŠ“å–çš„æ‹›è˜å…¬å‘Šï¼Œä¾¿äºç»Ÿä¸€æŸ¥çœ‹ä¸æ›´æ–°ã€‚</p>

    <div class="filters">
      <span><label>åŸå¸‚</label>
        <select id="filterCity">
          <option value="">å…¨éƒ¨åŸå¸‚</option>
        </select>
      </span>
      <span><label>é™¢æ ¡ç±»å‹</label>
        <select id="filterSchoolType">
          <option value="">å…¨éƒ¨</option>
          <option value="æœ¬ç§‘">æœ¬ç§‘</option>
          <option value="ä¸“ç§‘">ä¸“ç§‘</option>
        </select>
      </span>
      <span><label>é™¢æ ¡å±‚æ¬¡</label>
        <select id="filterCategory">
          <option value="">å…¨éƒ¨</option>
          <option value="985">985</option>
          <option value="211">211</option>
          <option value="æ™®é€šä¸€æœ¬">æ™®é€šä¸€æœ¬</option>
          <option value="æ™®é€šäºŒæœ¬">æ™®é€šäºŒæœ¬</option>
          <option value="æ™®é€šä¸‰æœ¬">æ™®é€šä¸‰æœ¬</option>
          <option value="å¤§ä¸“">å¤§ä¸“</option>
        </select>
      </span>
    </div>

    <p class="meta" id="meta">åŠ è½½ä¸­â€¦</p>

    <div class="tabs">
      <button type="button" data-tab="schools">æŒ‰å­¦æ ¡å…¥å£ï¼ˆ<span id="schoolCount">â€”</span> æ‰€é™¢æ ¡ç›´è¾¾é“¾æ¥ï¼‰</button>
      <button type="button" data-tab="jobs">æ‹›è˜ä¿¡æ¯åˆ—è¡¨</button>
    </div>

    <section id="panel-schools" class="panel active">
      <h2>å„æ ¡æ‹›è˜/äººäº‹å¤„å…¥å£</h2>
      <p class="meta" style="margin-top:0;">ã€Œ<strong>æ‹›è˜é¡µ</strong>ã€ä¸ºç™¾åº¦æœç´¢ã€Œæ ¡å äººäº‹ æ‹›è˜ã€ç»“æœä¸­çš„ã€å®˜æ–¹ã€‘æˆ–ç¬¬ä¸€æ¡äººäº‹/æ‹›è˜é“¾æ¥ï¼›æ— åˆ™æ‰“å¼€è¯¥æœç´¢é¡µã€‚ã€Œ<strong>ğŸ”</strong>ã€å§‹ç»ˆæ‰“å¼€ç™¾åº¦æœç´¢é¡µï¼Œå¯è‡ªè¡Œç‚¹å‡»ã€å®˜æ–¹ã€‘é“¾æ¥ã€‚</p>
      <ul class="school-list" id="schoolList"></ul>
    </section>

    <section id="panel-jobs" class="panel">
      <h2>æ‹›è˜ä¿¡æ¯ï¼ˆæ¥è‡ªå„æ ¡äººäº‹å¤„é¡µé¢æŠ“å–ï¼‰</h2>
      <ul class="job-list" id="jobList"></ul>
      <p class="empty" id="jobEmpty" style="display:none;">æš‚æ— æŠ“å–åˆ°çš„æ‹›è˜æ¡ç›®ã€‚åœ¨ç»ˆç«¯æ‰§è¡Œï¼š<br><code>cd é¡¹ç›®ç›®å½• && pip3 install -r requirements.txt && python3 update_jobs.py</code></p>
    </section>

    <div class="footer-legend" id="footerLegend">
      <strong>å›¾ä¾‹ï¼š</strong><br>
      æ‹›è˜é¡µï¼šè¯¥æ ¡äººäº‹/æ‹›è˜é¡µï¼ˆæ¥è‡ªç™¾åº¦æœç´¢ã€å®˜æ–¹ã€‘æˆ–é¦–æ¡ï¼‰ï¼›æ— åˆ™æ‰“å¼€ç™¾åº¦æœç´¢é¡µã€‚<br>
      ğŸ”ï¼šæ‰“å¼€ç™¾åº¦ã€Œæ ¡å äººäº‹ æ‹›è˜ã€æœç´¢é¡µï¼Œå¯è‡ªç‚¹ã€å®˜æ–¹ã€‘é“¾æ¥ã€‚<br>
      æ–‡ï¼šè¿‘ 30 å¤©å†…æœ‰æ–‡ç§‘ç›¸å…³æ‹›è˜æˆ–å…¬å‘Šã€‚<br>
      newï¼šè¿‘ 7 å¤©å†…æœ‰ä¸æ‹›è˜/äººæ‰/å…¬ç¤º/åˆ¶åº¦/å¼•è¿›/å…¬å‘Š/é€šçŸ¥ç­‰ç›¸å…³çš„æ›´æ–°ã€‚<br>
      ç–‘ï¼šæ‹›è˜é¡µæ— æ³•æ‰“å¼€æ—¶ï¼Œé“¾æ¥ä¸ºç™¾åº¦ã€Œæ ¡å äººäº‹ æ‹›è˜ã€æœç´¢é¡µï¼Œè¯·è‡ªç‚¹é¦–æ¡ç»“æœï¼›ä¸‹æ‹‰æ˜¾ç¤ºã€Œæš‚æ— ä¿¡æ¯ï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»ğŸ”æ ¸å®æœç´¢ç»“æœã€ã€‚<br>
      ä¸‹æ‹‰æ¡†ï¼šä»…å±•ç¤ºä¸æ‹›è˜/äººæ‰ç›¸å…³çš„æœ€æ–° 3 æ¡å…¬å‘Šï¼Œæ— åˆ™ä¸å±•ç¤ºã€‚
    </div>
    <p class="footer-cheer" id="footerCheer" title="åŒå‡»é£å‡ºå°æƒŠå–œ">æœç€æƒ³è¦çš„ç”Ÿæ´»å»å®è·µï¼Œç»ˆèƒ½æ”¶è·å±äºè‡ªå·±çš„å¹¸ç¦ã€‚</p>
  </div>

  <script>
    let jobsData = { last_updated: "", jobs: [], sources: [] };
    let universitiesData = { universities: [] };
    let failedSchoolsSet = new Set();
    var SUSPECTED_FAILED_SCHOOLS = ["å¹¿å·å•†å­¦é™¢","åŒ—äº¬ç†å·¥å¤§å­¦ç æµ·å­¦é™¢","å¹¿ä¸œç§‘æŠ€å­¦é™¢","å¹¿ä¸œç†å·¥å­¦é™¢","ä¸œèåŸå¸‚å­¦é™¢","å¹¿å·æ–°åå­¦é™¢","å¹¿ä¸œç¬¬äºŒå¸ˆèŒƒå­¦é™¢","å—æ–¹ç§‘æŠ€å¤§å­¦","æ·±åœ³ä¿¡æ¯èŒä¸šæŠ€æœ¯å¤§å­¦","å¹¿å·æ°‘èˆªèŒä¸šæŠ€æœ¯å­¦é™¢"];
    let currentCity = "";
    let currentSchoolType = "";
    let currentCategory = "";

    const CATEGORY_ORDER = { "985": 0, "211": 1, "æ™®é€šä¸€æœ¬": 2, "æ™®é€šäºŒæœ¬": 3, "æ™®é€šä¸‰æœ¬": 4, "å¤§ä¸“": 5 };
    const WEN_KEYWORDS = /æ–‡|æ–‡å­¦|å†å²|å“²å­¦|æ³•å­¦|æ”¿æ²»|ç¤¾ä¼š|ä¼ åª’|è¯­è¨€|è‰ºæœ¯|æ•™è‚²|å¿ƒç†|é©¬é™¢|æ€æ”¿|ä¸­æ–‡|å¤–è¯­|ç»ç®¡|æ–°é—»|ä¼ æ’­|äººæ–‡/i;
    var NEW_KEYWORDS = /æ‹›è˜|äººæ‰|å…¬ç¤º|åˆ¶åº¦|å¼•è¿›|å¼€å§‹|å…¬å‘Š|é€šçŸ¥|æ‹›å½•|é€‰è˜|è˜ä»»|äººäº‹|é«˜å±‚æ¬¡|æ•™å¸ˆ|è¡Œæ”¿|å…¬å¼€æ‹›è˜/i;

    function isWithin7Days(dateStr) {
      if (!dateStr) return false;
      const d = new Date(dateStr); if (isNaN(d.getTime())) return false;
      const now = new Date(); const diff = (now - d) / (24 * 60 * 60 * 1000);
      return diff >= 0 && diff <= 7;
    }
    function isWithin30Days(dateStr) {
      if (!dateStr) return false;
      const d = new Date(dateStr); if (isNaN(d.getTime())) return false;
      const now = new Date(); const diff = (now - d) / (24 * 60 * 60 * 1000);
      return diff >= 0 && diff <= 30;
    }

    function getSchoolJobs(schoolName) {
      const jobs = (jobsData.jobs || []).filter(j => j.school === schoolName);
      jobs.sort((a, b) => (b.fetched_at || "").localeCompare(a.fetched_at || ""));
      return jobs;
    }

    function isArticleLikeTitle(title) {
      const t = (title || "").trim();
      const navLike = /^(äººäº‹æ”¿ç­–|äººäº‹æ”¹é©|å·¥ä½œæµç¨‹|åŠäº‹æŒ‡å—|æœºæ„è®¾ç½®|è§„ç« åˆ¶åº¦|ä¸‹è½½ä¸“åŒº|é€šçŸ¥å…¬å‘Š|æ‹›è˜ä¿¡æ¯|é¦–é¡µ|æ›´å¤š|åˆ—è¡¨|æ ç›®|æ”¿ç­–æ³•è§„|å¸ˆèµ„é˜Ÿä¼|éƒ¨é—¨ä»‹ç»|è”ç³»æˆ‘ä»¬|äººæ‰æ‹›è˜)$/;
      if (navLike.test(t) || t.length <= 4) return false;
      if (/å…¬å‘Š|é€šçŸ¥|åŠæ³•|æ¡ä¾‹|å¯äº‹|å…¬ç¤º|ç®€ç« |è®¡åˆ’|è§„å®š|æ„è§/.test(t)) return true;
      if (/20\d{2}/.test(t)) return true;
      return t.length >= 12;
    }

    function isRecruitmentOrTalentRelated(title) {
      const t = (title || "").trim();
      if (!t) return false;
      const recruitmentKeywords = /æ‹›è˜|äººæ‰å¼•è¿›|äººæ‰æ”¿ç­–|å¼•è¿›|æ‹›å½•|é€‰è˜|è˜ä»»|äººæ‰éœ€æ±‚|é«˜å±‚æ¬¡äººæ‰|æ‹›è˜å…¬å‘Š|æ‹›è˜å¯äº‹|æ•™å¸ˆæ‹›è˜|è¡Œæ”¿æ‹›è˜|ä¸“èŒæ•™å¸ˆ|äººäº‹(æ‹›è˜|å¼•è¿›)/;
      return recruitmentKeywords.test(t);
    }

    function getTop3ArticleLikeJobs(schoolJobs) {
      var pool = schoolJobs.filter(function(j) {
        return isRecruitmentOrTalentRelated(j.title) || WEN_KEYWORDS.test(j.title || "");
      });
      return pool.slice(0, 3);
    }

    async function loadData() {
      try {
        const [jobsRes, univRes, failedRes] = await Promise.all([
          fetch("data/jobs.json"),
          fetch("data/universities_guangdong.json"),
          fetch("data/failed_recruitment_schools.json").catch(() => null)
        ]);
        if (jobsRes.ok) jobsData = await jobsRes.json();
        if (univRes.ok) universitiesData = await univRes.json();
        if (failedRes && failedRes.ok) {
          const arr = await failedRes.json();
          failedSchoolsSet = new Set(Array.isArray(arr) ? arr : []);
        }
        SUSPECTED_FAILED_SCHOOLS.forEach(function(name) { failedSchoolsSet.add(name); });
      } catch (e) {
        console.error(e);
        document.getElementById("meta").textContent = "æ— æ³•åŠ è½½ data ä¸‹çš„ JSONï¼ˆè¯·ç”¨æœ¬åœ°æœåŠ¡å™¨æ‰“å¼€é¡µé¢ï¼Œå¦‚ python -m http.serverï¼‰ã€‚";
        return;
      }
      const u = universitiesData.universities || [];
      const jobs = jobsData.jobs || [];
      var countEl = document.getElementById("schoolCount");
      if (countEl) countEl.textContent = u.length;
      document.getElementById("meta").innerHTML =
        "æ•°æ®æ›´æ–°æ—¶é—´ï¼š<strong>" + (jobsData.last_updated || "â€”") + "</strong>ã€‚"
        + " å…± " + u.length + " æ‰€é™¢æ ¡ã€å½“å‰æŠ“å– " + jobs.length + " æ¡æ‹›è˜ç›¸å…³ä¿¡æ¯ã€‚"
        + " æ›´æ–°æ–¹å¼è§ READMEã€‚";
      fillCityOptions(u);
      renderJobs();
      renderSchools(u);
    }

    var CITY_GDP_ORDER = ["æ·±åœ³å¸‚","å¹¿å·å¸‚","ä½›å±±å¸‚","ä¸œèå¸‚","æƒ å·å¸‚","ç æµ·å¸‚","ä¸­å±±å¸‚","æ±Ÿé—¨å¸‚","æ¹›æ±Ÿå¸‚","èŒ‚åå¸‚","è‚‡åº†å¸‚","æ±•å¤´å¸‚","æ¸…è¿œå¸‚","éŸ¶å…³å¸‚","æ­é˜³å¸‚","é˜³æ±Ÿå¸‚","æ¢…å·å¸‚","æ½®å·å¸‚","æ²³æºå¸‚","æ±•å°¾å¸‚","äº‘æµ®å¸‚"];
    function cityOrder(c) { const i = CITY_GDP_ORDER.indexOf(c || ""); return i >= 0 ? i : 999; }
    function fillCityOptions(universities) {
      const set = new Set(universities.map(x => x.city).filter(Boolean));
      const sel = document.getElementById("filterCity");
      const sorted = Array.from(set).sort((a, b) => cityOrder(a) - cityOrder(b));
      sel.innerHTML = "";
      const opt0 = document.createElement("option");
      opt0.value = "";
      opt0.textContent = "å…¨éƒ¨åŸå¸‚";
      sel.appendChild(opt0);
      sorted.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        sel.appendChild(opt);
      });
      if (!sel._bound) {
        sel._bound = true;
        sel.addEventListener("change", () => { currentCity = sel.value; renderJobs(); renderSchools(universitiesData.universities || []); });
      }
    }

    document.getElementById("filterSchoolType").addEventListener("change", function() {
      currentSchoolType = this.value;
      renderJobs();
      renderSchools(universitiesData.universities || []);
    });
    document.getElementById("filterCategory").addEventListener("change", function() {
      currentCategory = this.value;
      renderSchools(universitiesData.universities || []);
    });

    function filterJob(job) {
      const schools = universitiesData.universities || [];
      const school = schools.find(s => s.name === job.school);
      if (currentCity && (!school || school.city !== currentCity)) return false;
      if (currentSchoolType && (!school || school.type !== currentSchoolType)) return false;
      return true;
    }

    function renderJobs() {
      const jobs = (jobsData.jobs || []).filter(filterJob);
      const ul = document.getElementById("jobList");
      const empty = document.getElementById("jobEmpty");
      ul.innerHTML = "";
      if (jobs.length === 0) {
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";
      jobs.forEach(job => {
        const li = document.createElement("li");
        li.className = "job-item";
        li.innerHTML =
          "<span class=\"job-school\">" + escapeHtml(job.school) + "</span> "
          + "<span class=\"job-type " + escapeHtml(job.type) + "\">" + escapeHtml(job.type) + "</span> "
          + "<a href=\"" + escapeHtml(job.url) + "\" target=\"_blank\" rel=\"noopener\">" + escapeHtml(job.title) + "</a>";
        ul.appendChild(li);
      });
    }

    function renderSchools(universities) {
      let list = universities;
      if (currentCity) list = list.filter(u => u.city === currentCity);
      if (currentSchoolType) list = list.filter(u => u.type === currentSchoolType);
      if (currentCategory) list = list.filter(u => (u.category || "") === currentCategory);
      list = list.slice().sort((a, b) => {
        const cityC = cityOrder(a.city) - cityOrder(b.city);
        if (cityC !== 0) return cityC;
        const typeOrder = (x) => (x.type === "æœ¬ç§‘" ? 0 : 1);
        const typeC = typeOrder(a) - typeOrder(b);
        if (typeC !== 0) return typeC;
        return (CATEGORY_ORDER[a.category] ?? 99) - (CATEGORY_ORDER[b.category] ?? 99);
      });
      const ul = document.getElementById("schoolList");
      ul.innerHTML = "";
      list.forEach(u => {
        const isFailed = failedSchoolsSet.has(u.name);
        const baiduSearchUrl = "https://www.baidu.com/s?wd=" + encodeURIComponent(u.name + " äººäº‹éƒ¨ æ‹›è˜");
        const officialPageUrl = (u.recruitment_url || "").trim();
        const category = u.category || "";
        const primaryHref = isFailed ? baiduSearchUrl : (officialPageUrl || baiduSearchUrl);
        const schoolJobs = getSchoolJobs(u.name);
        const recentJobs = schoolJobs.filter(j => isWithin7Days(j.fetched_at));
        const recentJobs30 = schoolJobs.filter(j => isWithin30Days(j.fetched_at));
        const hasNew = recentJobs.some(j => NEW_KEYWORDS.test(j.title || ""));
        const hasWen = recentJobs30.some(j => WEN_KEYWORDS.test(j.title || ""));
        const top3 = getTop3ArticleLikeJobs(schoolJobs);
        const wrapper = document.createElement("li");
        wrapper.className = "school-item-wrapper";
        const newHtml = hasNew ? "<span class=\"new-badge\">new</span>" : "";
        const wenHtml = hasWen ? "<span class=\"wen-badge\">æ–‡</span>" : "";
        const yiHtml = isFailed ? "<span class=\"yi-badge\">ç–‘</span>" : "";
        let dropdownHtml;
        if (top3.length > 0) {
          dropdownHtml = "<div class=\"school-item-dropdown\">" + top3.map(j => "<a href=\"" + escapeHtml(j.url) + "\" target=\"_blank\" rel=\"noopener\" title=\"" + escapeHtml(j.title) + "\">" + escapeHtml(j.title) + "</a>").join("") + "</div>";
        } else if (isFailed) {
          dropdownHtml = "<div class=\"school-item-dropdown\"><span class=\"muted\">æš‚æ— ä¿¡æ¯ï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»ğŸ”æ ¸å®æœç´¢ç»“æœ</span></div>";
        } else {
          dropdownHtml = "<div class=\"school-item-dropdown\"><span class=\"muted\">æš‚æ— æŠ“å–å…¬å‘Šï¼Œè¿è¡Œ update_jobs.py å¯æ›´æ–°</span></div>";
        }
        wrapper.innerHTML =
          "<div class=\"school-item\">"
          + "<span class=\"school-name\">" + escapeHtml(u.name) + " Â· " + escapeHtml(u.city || "") + " Â· " + escapeHtml(u.type || "") + (category ? " Â· " + escapeHtml(category) : "") + "</span> "
          + "<span class=\"link-wrap\">" + newHtml + wenHtml + yiHtml + "<a href=\"" + escapeHtml(primaryHref) + "\" target=\"_blank\" rel=\"noopener\" class=\"link-primary\">æ‹›è˜é¡µ</a>"
          + " <a href=\"" + escapeHtml(baiduSearchUrl) + "\" target=\"_blank\" rel=\"noopener\" class=\"search-fallback\" title=\"ç™¾åº¦æœç´¢è¯¥æ ¡äººäº‹éƒ¨æ‹›è˜\">ğŸ”</a></span></div>"
          + dropdownHtml;
        ul.appendChild(wrapper);
      });
    }

    function escapeHtml(s) {
      if (s == null) return "";
      const div = document.createElement("div");
      div.textContent = s;
      return div.innerHTML;
    }

    document.querySelectorAll(".tabs button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById("panel-" + btn.dataset.tab).classList.add("active");
      });
    });
    // é»˜è®¤é€‰ä¸­ã€ŒæŒ‰å­¦æ ¡å…¥å£ã€
    document.querySelector(".tabs button[data-tab='schools']").classList.add("active");
    document.querySelector("#panel-jobs").classList.remove("active");
    document.querySelector("#panel-schools").classList.add("active");

    loadData();

    (function notebook() {
      const STORAGE_KEY = "guangdong_recruitment_notebook";
      const panel = document.getElementById("notebookPanel");
      const head = document.getElementById("notebookHead");
      const body = document.getElementById("notebookBody");
      const btn = document.getElementById("notebookBtn");
      const closeBtn = document.getElementById("notebookClose");
      const nbBold = document.getElementById("nbBold");
      const nbColor = document.getElementById("nbColor");
      const nbChecklist = document.getElementById("nbChecklist");
      const nbOpacity = document.getElementById("nbOpacity");
      const nbWidth = document.getElementById("nbWidth");
      const nbHeight = document.getElementById("nbHeight");
      const nbDateSelect = document.getElementById("nbDateSelect");

      function todayStr() { const d = new Date(); return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,"0") + "-" + String(d.getDate()).padStart(2,"0"); }
      function loadStorage() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); } catch(e) { return {}; } }
      function saveStorage(o) { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(o)); } catch(e) {} }

      let currentDate = todayStr();
      let dragStart = null;

      function getState() {
        return {
          html: body.innerHTML,
          width: panel.offsetWidth,
          height: panel.offsetHeight,
          opacity: parseFloat(panel.style.opacity || "1"),
          left: parseInt(panel.style.left, 10) || 100,
          top: parseInt(panel.style.top, 10) || 100
        };
      }
      function setState(s) {
        if (s.html != null) body.innerHTML = s.html;
        if (s.width != null) panel.style.width = s.width + "px";
        if (s.height != null) panel.style.height = s.height + "px";
        if (s.opacity != null) panel.style.opacity = s.opacity;
        if (s.left != null) panel.style.left = s.left + "px";
        if (s.top != null) panel.style.top = s.top + "px";
      }
      function saveCurrent() {
        const o = loadStorage();
        o[currentDate] = getState();
        o.currentDate = currentDate;
        saveStorage(o);
      }
      function refreshDateSelect() {
        const o = loadStorage();
        const dates = Object.keys(o).filter(k => k !== "currentDate" && /^\d{4}-\d{2}-\d{2}$/.test(k)).sort().reverse();
        const today = todayStr();
        if (dates.indexOf(today) === -1) dates.unshift(today);
        nbDateSelect.innerHTML = dates.map(d => "<option value=\"" + d + "\"" + (d === currentDate ? " selected" : "") + ">" + d + "</option>").join("");
      }
      function loadForDate(date) {
        if (currentDate && currentDate !== date) saveCurrent();
        currentDate = date;
        const o = loadStorage();
        const s = o[date] || {};
        const defaultLeft = Math.max(20, (window.innerWidth || 800) - 400);
        const defaultTop = Math.max(20, Math.floor((window.innerHeight || 600) * 0.15));
        setState({
          html: s.html != null ? s.html : "",
          width: s.width || 320,
          height: s.height || 280,
          opacity: s.opacity != null ? s.opacity : 0.98,
          left: s.left != null ? s.left : defaultLeft,
          top: s.top != null ? s.top : defaultTop
        });
        refreshDateSelect();
      }

      const mini = document.getElementById("notebookMini");
      const miniIcon = document.getElementById("nbMiniIcon");
      const miniClose = document.getElementById("nbMiniClose");
      const nbSave = document.getElementById("nbSave");
      const resizeHandle = document.getElementById("notebookResize");

      nbSave.addEventListener("click", function() {
        saveCurrent();
        refreshDateSelect();
        const t = nbSave.textContent;
        nbSave.textContent = "å·²ä¿å­˜";
        nbSave.title = "å·²æŒ‰å½“å‰æ—¥æœŸï¼ˆ" + currentDate + "ï¼‰ä¿å­˜ï¼Œå¯é€šè¿‡ä¸Šæ–¹ã€Œæ—¥æœŸã€ä¸‹æ‹‰æŸ¥çœ‹å¾€æ—¥è‰ç¨¿";
        setTimeout(function() { nbSave.textContent = t; nbSave.title = ""; }, 2000);
      });
      nbDateSelect.addEventListener("change", function() { loadForDate(this.value); });
      btn.addEventListener("click", function() {
        panel.classList.add("open");
        btn.style.display = "none";
        mini.classList.remove("visible");
        currentDate = todayStr();
        loadForDate(currentDate);
        body.focus();
      });
      closeBtn.addEventListener("click", function() {
        saveCurrent();
        var panelRect = panel.getBoundingClientRect();
        panel.classList.remove("open");
        btn.style.display = "none";
        mini.classList.remove("minimized");
        mini.style.transition = "none";
        mini.style.left = panelRect.left + "px";
        mini.style.top = panelRect.top + "px";
        mini.style.right = "auto";
        mini.classList.add("visible");
        requestAnimationFrame(function() {
          requestAnimationFrame(function() {
            mini.classList.add("fly-to-corner");
            mini.style.transition = "left 0.45s cubic-bezier(0.25,0.1,0.25,1), top 0.45s cubic-bezier(0.25,0.1,0.25,1)";
            mini.style.left = "auto";
            mini.style.right = "0";
            mini.style.top = "12px";
            mini.classList.add("minimized");
            setTimeout(function() { mini.style.transition = ""; mini.classList.remove("fly-to-corner"); }, 500);
          });
        });
      });
      miniIcon.addEventListener("click", function() {
        mini.classList.remove("visible");
        panel.classList.add("open");
        btn.style.display = "none";
        currentDate = todayStr();
        loadForDate(currentDate);
        body.focus();
      });
      miniClose.addEventListener("click", function() {
        mini.classList.add("minimized");
        mini.style.right = "20px";
        mini.style.top = "20px";
        mini.style.left = "auto";
      });
      mini.addEventListener("mousedown", function(e) {
        if (e.target === miniClose || e.target === miniIcon) return;
        const mx = e.clientX - (parseInt(mini.style.left, 10) || 0);
        const my = e.clientY - (parseInt(mini.style.top, 10) || 0);
        function move(ev) {
          mini.style.left = (ev.clientX - mx) + "px";
          mini.style.top = (ev.clientY - my) + "px";
          mini.style.right = "auto";
        }
        function up() { document.removeEventListener("mousemove", move); document.removeEventListener("mouseup", up); }
        document.addEventListener("mousemove", move);
        document.addEventListener("mouseup", up);
      });

      nbOpacity.addEventListener("input", function() { panel.style.opacity = this.value; saveCurrent(); });
      nbBold.addEventListener("click", function() { document.execCommand("bold", false, null); body.focus(); });
      nbColor.addEventListener("input", function() { document.execCommand("foreColor", false, this.value); body.focus(); });
      nbChecklist.addEventListener("click", function() {
        const div = document.createElement("div");
        div.className = "notebook-checklist-item";
        const text = document.createElement("div");
        text.className = "nb-check-text";
        text.contentEditable = "true";
        text.textContent = "å¾…åŠé¡¹";
        div.innerHTML = "";
        div.appendChild(document.createElement("input")).type = "checkbox";
        div.appendChild(text);
        div.querySelector("input").addEventListener("change", function() { div.classList.toggle("done", this.checked); saveCurrent(); });
        text.addEventListener("input", saveCurrent);
        body.appendChild(div);
        text.focus();
      });

      let resizeStart = null;
      resizeHandle.addEventListener("mousedown", function(e) {
        e.preventDefault();
        resizeStart = { w: panel.offsetWidth, h: panel.offsetHeight, x: e.clientX, y: e.clientY };
      });
      document.addEventListener("mousemove", function(e) {
        if (!resizeStart) return;
        const dw = e.clientX - resizeStart.x, dh = e.clientY - resizeStart.y;
        panel.style.width = Math.min(600, Math.max(240, resizeStart.w + dw)) + "px";
        panel.style.height = Math.min(500, Math.max(180, resizeStart.h + dh)) + "px";
      });
      document.addEventListener("mouseup", function() { if (resizeStart) saveCurrent(); resizeStart = null; });

      head.addEventListener("mousedown", function(e) {
        if (e.target === closeBtn || e.target.closest("#notebookClose")) return;
        dragStart = { x: e.clientX - (parseInt(panel.style.left,10)||0), y: e.clientY - (parseInt(panel.style.top,10)||0) };
      });
      document.addEventListener("mousemove", function(e) {
        if (!dragStart) return;
        panel.style.left = (e.clientX - dragStart.x) + "px";
        panel.style.top = (e.clientY - dragStart.y) + "px";
      });
      document.addEventListener("mouseup", function() { dragStart = null; });

      body.addEventListener("input", function() { saveCurrent(); });
      body.addEventListener("blur", function() { saveCurrent(); });
      body.addEventListener("keydown", function(e) {
        if (e.key !== "Enter") return;
        var el = e.target;
        if (!el || !el.closest || !el.closest(".nb-check-text")) return;
        e.preventDefault();
        e.stopPropagation();
        var sel = window.getSelection();
        if (!sel || sel.rangeCount === 0) return;
        var range = sel.getRangeAt(0);
        var container = el.closest(".nb-check-text");
        if (!container) return;
        var br1 = document.createElement("br");
        var br2 = document.createElement("br");
        range.deleteContents();
        range.insertNode(br2);
        range.insertNode(br1);
        range.setStartAfter(br1);
        range.setEndAfter(br1);
        sel.removeAllRanges();
        sel.addRange(range);
        saveCurrent();
      });
      window.addEventListener("beforeunload", function() { saveCurrent(); });
    })();

    (function cheerEmoji() {
      const el = document.getElementById("footerCheer");
      const emojis = ["â¤ï¸","â¤ï¸","â¤ï¸","ğŸ‘ğŸ»","ğŸ‘ğŸ»","ğŸ’ªğŸ»","ğŸ’ªğŸ»","ğŸ’°","ğŸ’°","ğŸ’¦","ğŸ’¦","ğŸŒŸ","âœ¨","ğŸŒˆ","ğŸ¯","ğŸŒ»"];
      el.addEventListener("dblclick", function(e) {
        const rect = el.getBoundingClientRect();
        const cx = rect.left + rect.width / 2, cy = rect.top + rect.height / 2;
        const pick = emojis[Math.floor(Math.random() * emojis.length)];
        const n = 12 + Math.floor(Math.random() * 10);
        for (let i = 0; i < n; i++) {
          const span = document.createElement("span");
          span.className = "cheer-emoji";
          span.textContent = pick;
          const angle = (i / n) * Math.PI * 2 + Math.random() * 0.5;
          const dist = 60 + Math.random() * 80;
          span.style.left = (cx + Math.cos(angle) * 30) + "px";
          span.style.top = (cy + Math.sin(angle) * 30) + "px";
          span.style.setProperty("--dx", Math.cos(angle) * dist + "px");
          span.style.setProperty("--dy", Math.sin(angle) * dist + "px");
          document.body.appendChild(span);
          setTimeout(function() { span.remove(); }, 1200);
        }
      });
    })();
  </script>
</body>
</html>
